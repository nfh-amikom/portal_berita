<!DOCTYPE html>
<html>

<head>
    <title>Create Article</title>
    <!-- include libraries(jQuery, bootstrap) -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <!-- include summernote css/js -->
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
</head>

<body>
    <h3 class="text-center">Create Article with Summernote</h3>
    <div class="container">
        <form>
            <div class="form-group">
                <textarea id="summernote" name="editordata" style="margin-bottom: 100%;"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>
</body>
<script>
    const summerNoteInit = () => {
        $('#summernote').summernote({
            lang: 'en-US',
            imageAttributes: {
                icon: '<i class="note-icon-pencil"/>',
                removeEmpty: false, // true = remove attributes | false = leave empty if present
                disableUpload: false // true = don't display Upload Options | Display Upload Options
            },
            popover: {
                image: [
                    ['custom', ['imageAttributes']],
                    ['image', ['resizeFull', 'resizeHalf', 'resizeQuarter', 'resizeNone']],
                    ['float', ['floatLeft', 'floatRight', 'floatNone']],
                    ['remove', ['removeMedia']]
                ],
            },
            toolbar: [
                ['style', ['bold', 'italic', 'underline', 'clear']],
                ['font', ['strikethrough', 'superscript', 'subscript']],
                ['fontsize', ['fontsize']],
                ['color', ['color']],
                ['para', ['style', 'ul', 'ol', 'paragraph', 'height']],
                ['table', ['table']],
                ['insert', ['link', 'picture', 'video', 'hr', 'grid']],
                ['view', ['fullscreen', 'codeview', 'undo', 'redo', 'help']],
            ],
            grid: {
                wrapper: "row",
                columns: [
                    "col-md-12",
                    "col-md-6",
                    "col-md-4",
                    "col-md-3",
                    "col-md-24",
                ]
            },
            callbacks: {
                onImageUpload: function (image) {
                    sendFile(image[0]);
                },
                onMediaDelete: function (target) {
                    deleteFile(target[0].src);
                }
            },
            icons: {
                grid: "bi bi-grid-3x2"
            },
        });
    }
</script>
<script>
    $(document).ready(function () {
        // $('#summernote').summernote();
        summerNoteInit();
    });
    function sendFile(file, editor, welEditable) {
        token = "{{ csrf_token() }}"
        data = new FormData();
        data.append("file", file);
        data.append('_token', token);
        $('#loading-image-summernote').show();
        $('#summernote').summernote('disable');
        $.ajax({
            data: data,
            type: "POST",
            url: "{{ url('summernote/picture/upload/article') }}",
            cache: false,
            contentType: false,
            processData: false,
            success: function (url) {
                console.log(url);
                if (url['status'] == "success") {
                    $('#summernote').summernote('enable');
                    $('#loading-image-summernote').hide();
                    $('#summernote').summernote('editor.saveRange');
                    $('#summernote').summernote('editor.restoreRange');
                    $('#summernote').summernote('editor.focus');
                    $('#summernote').summernote('editor.insertImage', url['image_url']);
                }
                $("img").addClass("img-fluid");
            },
            error: function (data) {
                console.log(data)
                $('#summernote').summernote('enable');
                $('#loading-image-summernote').hide();
            }
        });
    }
    function deleteFile(target) {
        token = "{{ csrf_token() }}"
        data = new FormData();
        data.append("target", target);
        data.append('_token', token);
        $('#loading-image-summernote').show();
        $('.summernote').summernote('disable');
        $.ajax({
            data: data,
            type: "POST",
            url: "{{ url('summernote/picture/delete/article') }}",
            cache: false,
            contentType: false,
            processData: false,
            success: function (result) {
                console.log(result)
                if (result['status'] == "success") {
                    $('.summernote').summernote('enable');
                    $('#loading-image-summernote').hide();
                }
            },
            error: function (data) {
                console.log(data)
                $('.summernote').summernote('enable');
                $('#loading-image-summernote').hide();
            }
        });
    }
</script>

</html>